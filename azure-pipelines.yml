# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main # every commit will trigger this yml

pool:
  vmImage: windows-latest

stages:
- stage: DeployMkDocs
  jobs:
  - job: deploy_gh_pages
    displayName: Deploy MkDocs gh_pages

    variables:
      - group: galletaHong_creds

    steps:
    - checkout: self
    - script: echo Deploy MkDocs gh_pages.
      
    # force mkdocs version 1.1.2
    # reference: https://github.com/mkdocs/mkdocs/issues/2447
    - script: |
        git config --global user.name "$(galletaHong_userName)"
        git config --global user.email "$(galletaHong_email)"
      displayName: "Configure Git user"
    
    - script: |
        git config --global url."https://github.com/".insteadOf "git@github.com:"
        git config --global url."https://github.com/".insteadOf "ssh://git@github.com/"
        echo "https://$gltHng_USER:$gltHng_TOKEN@github.com" >> $HOME/.git-credentials
        git config --global url."https://".insteadOf git://
        git config --global credential.helper store
      displayName: "Update git config settings"
      env:
        gltHng_USER: $(galletaHong_userName)
        gltHng_TOKEN: $(repoToken)

    - pwsh: |
        pip install -U mkdocs
        pip install mkdocs-material
        mkdocs build
        mkdocs gh-deploy --force


###########################################
# file: /steps/git/git-config-user-v0.yaml
###########################################
# parameters:
#  username: codeway
#  email: codeway@external.groups.hp.com
# 
# steps:
# - script: |
#     git config --global user.name "${{ parameters.username }}"
#     git config --global user.email "${{ parameters.email }}"
#   displayName: "Update git config user"
#   env:
#     HOME: $(Agent.TempDirectory)


#####################################
# file: /steps/git/git-config-v0.yaml
#####################################
# parameters:
#  gheUser: ''
#  gheToken: ''
#  gheHostName: 'github.azc.ext.hp.com'
#
# steps:
# - bash: |
#     git config --global url."https://$GHE_HOSTNAME/".insteadOf "git@$GHE_HOSTNAME:"
#     git config --global url."https://$GHE_HOSTNAME/".insteadOf "ssh://git@$GHE_HOSTNAME/"
#     echo "https://$GHE_USER:$GHE_TOKEN@$GHE_HOSTNAME" >> $HOME/.git-credentials
#     git config --global url."https://".insteadOf git://
#     git config --global credential.helper store
#   displayName: "Update git config settings"
#   env:
#     GHE_USER: ${{ parameters.gheUser }}
#     GHE_TOKEN: ${{ parameters.gheToken }}
#     GHE_HOSTNAME: ${{ parameters.gheHostName }}
#     HOME: $(Agent.TempDirectory)
